<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title> Backlog </title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <%- include('./navbar.ejs', {project: project}) %>
    <script>
      function showDetail(id) {
        document.getElementById(id).style.display = ''
        document.getElementById("showButton"+id).style.display = 'none'
        document.getElementById("hideButton"+id).style.display = ''
      }
      function hideDetail(id) {
        document.getElementById(id).style.display = 'none'
        document.getElementById("showButton"+id).style.display = ''
        document.getElementById("hideButton"+id).style.display = 'none'
      }
    </script>
</head>

<body>
    <div class="container">
        
        <h2> Backlog </h2>
        <a href="/projects/<%= project._id %>/issues/create" class="btn btn-success"> Nouvelle issue </a>
        <% for( let issue of issues ){ %>
        <li class="media my-4">
          <button id="showButton<%=issue._id%>" class="btn btn-info" onclick="showDetail('<%=issue._id%>')">Plus</button>
          <button id="hideButton<%=issue._id%>" class="btn btn-info" onclick="hideDetail('<%=issue._id%>')" style="display:none">Moins</button>
            <div class="media-body <%=issue._color%>" role="alert">
              <h5>ID : <%=issue._id%></h5>
              Nom : <%=issue._name%> Priorité : <%=issue._priority%>
            </div>

            <form action="/projects/<%= project._id %>/tasks/<%= issue._id %>/linkTask" method="POST"> 
              <select name="taskList" id="taskList" size="1" selected="default">
                <option value="default"> Tâche à lier </option>
                <% for( let task of tasks ){ %>
                  <option value=<%=task._id%>> <%=task._id%> </option>
                <% } %>
              </select>
              <button type="submit" class="btn btn-success">Lier la tâche</button>
            </form>

            <a href="/projects/<%= project._id %>/tasks/<%= issue._id %>/tiedTask" class = "btn btn-success"> Créer une tâche liée</a>

            <a href="/projects/<%= project._id %>/issues/<%= issue._id %>/update" class = "btn btn-primary"> Modifier</a>

            <form action="/projects/<%= project._id %>/issues/<%= issue._id %>/delete" method="POST">
                <button type="submit" class="btn btn-danger">Supprimer</button>
            </form>
        </li>
        <div id="<%= issue._id %>" style="display:none;">
          <p>Description : <%=issue._description%></p>
          <p>Difficulté : <%=issue._difficulty%></p>
        </div>
        <% } %>
    </div>
</body>

</html>